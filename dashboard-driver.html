<!DOCTYPE html>
<html lang="nl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Dashboard - Sticki.one</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #f8f9fa; }
        .brand-text { color: #1a202c; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        .modal.active { display: flex; justify-content: center; items-center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 2rem; border: 1px solid #888; width: 90%; max-width: 500px; border-radius: 1rem; position: relative; animation: modal-swoop 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes modal-swoop { from { opacity: 0; transform: translateY(50px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .close-button { color: #aaa; position: absolute; top: 1rem; right: 1rem; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-step { display: none; }
        .modal-step.active { display: block; }
        .timeline-item::before { content: ''; position: absolute; left: 1.25rem; top: 1.25rem; bottom: -1.25rem; width: 2px; background-color: #e5e7eb; transform: translateX(-50%); }
        .timeline-item:last-child::before { display: none; }
        .progress-bar-container { background-color: #e5e7eb; border-radius: 9999px; overflow: hidden; }
        .progress-bar { background-color: #F97316; height: 100%; border-radius: 9999px; transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
             <a href="index.html" class="flex items-center gap-2 text-3xl brand-text shrink-0">
                <svg width="28" height="28" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="16" cy="16" r="16" fill="#F97316"/></svg>
                <span class="font-medium">Sticki</span><span class="font-light">.one</span>
             </a>
            <div class="flex items-center gap-4">
                <span class="text-sm text-gray-600">Welkom, Driver!</span>
                <a href="login.html" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg text-sm hover:bg-gray-300 transition">Uitloggen</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-6">

        <!-- Marketplace View -->
        <div id="marketplace-view">
            <h1 class="text-3xl font-bold mb-2">Kies je volgende campagne</h1>
            <p class="text-gray-500 mb-8">Selecteer een merk waar je achter staat en start met verdienen.</p>
            <div id="campaign-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Campaign cards will be inserted here by JS -->
            </div>
        </div>

        <!-- Campaign Progress View -->
        <div id="progress-view" class="hidden">
             <div class="bg-white p-8 rounded-2xl shadow-lg border mb-8">
                <div class="flex flex-col md:flex-row items-start gap-6">
                    <img id="campaign-img" src="izy-coffee.jpg" alt="Campaign Image" class="w-full md:w-48 h-32 rounded-lg object-cover">
                    <div class="w-full">
                        <h2 id="campaign-title" class="text-2xl font-bold">IZY Coffee Campagne</h2>
                        <p class="text-sm text-gray-500 mb-4">Looptijd: <span id="campaign-duration">3 maanden</span></p>
                        <div class="flex justify-between items-center mb-1 text-sm">
                            <p class="font-medium">Verdiensten</p>
                            <p><span id="earned-amount" class="font-bold">€0</span> / <span id="total-amount" class="font-bold">€90</span></p>
                        </div>
                        <div class="progress-bar-container w-full h-3">
                            <div id="earning-progress" class="progress-bar" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <h2 class="text-2xl font-bold mb-6">Jouw Campagne Tijdlijn</h2>
            <div id="campaign-timeline" class="relative">
                <!-- Timeline items will be dynamically inserted here -->
            </div>
        </div>

    </main>
    
    <!-- Modals -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div id="modal-step-1" class="modal-step">
                <h3 class="text-2xl font-bold mb-4 text-center">Bevestig je adres</h3>
                <p class="text-center text-gray-600 mb-6">Controleer je gegevens voordat we de sticker versturen.</p>
                <div class="space-y-4">
                     <div>
                        <label class="text-sm font-medium text-gray-700">Adres</label>
                        <input type="text" value="Voorbeeldstraat 123" class="w-full p-3 border border-gray-300 rounded-lg mt-1">
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-700">Postcode & Stad</label>
                        <div class="flex gap-4">
                             <input type="text" value="9000" class="w-1/3 p-3 border border-gray-300 rounded-lg mt-1">
                             <input type="text" value="Gent" class="w-2/3 p-3 border border-gray-300 rounded-lg mt-1">
                        </div>
                    </div>
                     <div>
                        <label class="text-sm font-medium text-gray-700">Verzendmethode</label>
                        <select class="w-full p-3 border border-gray-300 rounded-lg mt-1">
                            <option>Standaard Verzending (Gratis)</option>
                            <option>Express Verzending (€5,99)</option>
                        </select>
                    </div>
                </div>
                <button id="confirm-address-btn" class="w-full mt-6 bg-gray-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-900 transition">Adres Bevestigen</button>
            </div>
             <div id="modal-step-2" class="modal-step">
                <h3 id="confirm-modal-title" class="text-2xl font-bold mb-2 text-center">Bevestig je keuze</h3>
                <p id="confirm-modal-text" class="text-center text-gray-600 mb-6">Je staat op het punt om de campagne te starten.</p>
                <div class="bg-gray-100 p-4 rounded-lg">
                    <label class="flex items-center">
                        <input type="checkbox" id="confirm-checkbox" class="h-5 w-5 rounded text-orange-600 focus:ring-orange-500 border-gray-300">
                        <span class="ml-3 text-gray-700 text-sm">Ik bevestig dat ik van plan ben deze sticker op mijn wagen te kleven voor de duur van de campagne.</span>
                    </label>
                </div>
                <div class="flex gap-4 mt-6">
                    <button id="cancel-btn" class="w-1/2 bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition">Annuleren</button>
                    <button id="confirm-btn" class="w-1/2 bg-gray-500 text-white font-bold py-3 px-6 rounded-lg transition cursor-not-allowed" disabled>Bevestig en Verstuur</button>
                </div>
            </div>
        </div>
    </div>

    <div id="qrModal" class="modal">
        <div class="modal-content text-center">
             <span class="close-button">&times;</span>
             <h3 class="text-2xl font-bold mb-4">Upload je foto's</h3>
             <p class="text-gray-600 mb-6">Scan de QR-code met je smartphone om je camera te openen en de foto's te maken. Uploaden vanuit je bibliotheek is niet mogelijk.</p>
             <div id="qrcode" class="flex justify-center"></div>
             <p class="mt-4 text-sm text-gray-500">Deze code is 5 minuten geldig.</p>
        </div>
    </div>
    
    <script>
        // --- DATA ---
        const campaigns = [
            { id: 1, brand: 'IZY Coffee', desc: 'Steun je lokale koffiebar.', image: 'izy-coffee.jpg', duration: 3, minKm: 750, totalReward: 90, available: 39 },
            { id: 2, brand: 'Jumbo Supermarkten', desc: 'Voor de dagelijkse boodschappen.', image: 'jumbo.jpg', duration: 12, minKm: 750, totalReward: 360, available: 164 },
            { id: 3, brand: 'Hedin Automotive', desc: 'Passie voor auto\'s.', image: 'hedin-automotive.jpg', duration: 9, minKm: 750, totalReward: 270, available: 0 },
        ];
        
        let activeCampaign = null;

        // --- DOM ELEMENTS ---
        const marketplaceView = document.getElementById('marketplace-view');
        const progressView = document.getElementById('progress-view');
        const campaignList = document.getElementById('campaign-list');
        const confirmModal = document.getElementById('confirmModal');
        const qrModal = document.getElementById('qrModal');
        const confirmCheckbox = document.getElementById('confirm-checkbox');
        const confirmBtn = document.getElementById('confirm-btn');

        // --- FUNCTIONS ---
        function renderMarketplace() {
            campaignList.innerHTML = '';
            campaigns.forEach(c => {
                const isAvailable = c.available > 0;
                const cardClass = isAvailable ? 'cursor-pointer hover:shadow-xl hover:-translate-y-1' : 'opacity-50';
                const buttonHtml = isAvailable ? `<div class="bg-green-100 text-green-800 text-xs font-semibold px-3 py-1 rounded-full">Nog ${c.available} plekken</div>` : `<div class="bg-red-100 text-red-800 text-xs font-semibold px-3 py-1 rounded-full">Volzet</div>`;
                
                campaignList.innerHTML += `
                    <div class="bg-white p-4 rounded-2xl shadow-lg border transition-all duration-300 ${cardClass}" ${isAvailable ? `onclick="selectCampaign(${c.id})"` : ''}>
                        <div class="bg-gray-100 h-40 rounded-lg mb-4 overflow-hidden">
                             <img src="${c.image}" alt="${c.brand}" class="w-full h-full object-cover">
                        </div>
                        <h3 class="font-bold text-lg">${c.brand}</h3>
                        <p class="text-sm text-gray-500 mb-4">${c.desc}</p>
                        <div class="text-xs text-gray-500 grid grid-cols-3 gap-2 text-center border-t pt-4">
                           <div><p class="font-bold text-sm text-gray-800">${c.duration} mnd</p><p>Duurtijd</p></div>
                           <div><p class="font-bold text-sm text-gray-800">${c.minKm} km</p><p>Min./maand</p></div>
                           <div><p class="font-bold text-sm text-orange-600">€${c.totalReward}</p><p>Totaal</p></div>
                        </div>
                        <div class="mt-4 flex justify-center">
                            ${buttonHtml}
                        </div>
                    </div>
                `;
            });
        }

        function selectCampaign(id) {
            const campaign = campaigns.find(c => c.id === id);
            document.getElementById('confirm-modal-title').innerText = `Bevestig je keuze voor ${campaign.brand}`;
            document.getElementById('confirm-modal-text').innerText = `Je staat op het punt om de campagne voor ${campaign.brand} te starten.`;
            confirmModal.dataset.campaignId = id;
            document.getElementById('modal-step-1').classList.add('active');
            document.getElementById('modal-step-2').classList.remove('active');
            confirmModal.classList.add('active');
        }

        function startCampaign(id) {
            activeCampaign = campaigns.find(c => c.id === id);
            marketplaceView.classList.add('hidden');
            progressView.classList.remove('hidden');
            renderTimeline();
        }

        function renderTimeline() {
            document.getElementById('campaign-img').src = activeCampaign.image;
            document.getElementById('campaign-title').innerText = `${activeCampaign.brand} Campagne`;
            document.getElementById('campaign-duration').innerText = `${activeCampaign.duration} maanden`;
            document.getElementById('total-amount').innerText = `€${activeCampaign.totalReward}`;
            
            const timelineContainer = document.getElementById('campaign-timeline');
            timelineContainer.innerHTML = '';
            
            const now = new Date();
            let currentDate = new Date();
            let earned = 0;

            const baseTimeline = [
                { status: 'Voltooid', title: 'Campagne Geselecteerd', date: new Date(currentDate), desc: 'Je hebt je aangemeld voor de campagne.'},
                { status: 'Voltooid', title: 'Sticker is Onderweg', date: new Date(currentDate), desc: 'Verwacht je sticker binnen 5 werkdagen.' },
            ];

            currentDate.setDate(currentDate.getDate() + 5);
            baseTimeline.push({ status: 'Actie Vereist', title: 'Sticker Installeren', date: new Date(currentDate), desc: 'Sticker ontvangen? Upload nu je eerste foto\'s.', action: 'upload' });
            
            for (let i = 1; i <= activeCampaign.duration; i++) {
                currentDate.setMonth(currentDate.getMonth() + 1);
                 let paymentStatus = (new Date(currentDate) < now) ? 'Voltooid' : 'Gepland';
                 if (paymentStatus === 'Voltooid') earned += activeCampaign.totalReward / activeCampaign.duration;
                 baseTimeline.push({
                     status: paymentStatus,
                     title: `Betaling Maand ${i}`,
                     date: new Date(currentDate),
                     desc: `Tijd voor je maandelijkse foto's. Na goedkeuring ontvang je €${activeCampaign.totalReward / activeCampaign.duration}.`,
                     action: (new Date(currentDate) >= now && paymentStatus !== 'Voltooid') ? 'upload' : null
                 });
            }
            
            // Add "select new campaign" step
            let renewalDate = new Date(currentDate);
            renewalDate.setMonth(renewalDate.getMonth() -1);
            let renewalStatus = (now >= renewalDate) ? 'Actie Vereist' : 'Gepland';
             baseTimeline.splice(baseTimeline.length -1, 0, {
                 status: renewalStatus,
                 title: 'Campagne Bijna Voltooid',
                 date: renewalDate,
                 desc: 'Je huidige campagne loopt bijna af. Kies nu alvast een nieuwe om zonder onderbreking door te verdienen.',
                 action: 'renew'
             });


            // Update earned amount and progress bar
            document.getElementById('earned-amount').innerText = `€${earned.toFixed(0)}`;
            document.getElementById('earning-progress').style.width = `${(earned / activeCampaign.totalReward) * 100}%`;

            baseTimeline.forEach(item => {
                const isPast = new Date(item.date) < now && item.status !== 'Actie Vereist';
                const statusColors = {
                    'Voltooid': 'bg-green-100 text-green-800',
                    'Actie Vereist': 'bg-orange-100 text-orange-800 animate-pulse',
                    'Gepland': 'bg-gray-100 text-gray-800',
                };
                
                let actionButton = '';
                if(item.action === 'upload' && item.status !== 'Voltooid'){
                    actionButton = `<button onclick="openQrModal()" class="mt-4 bg-orange-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-orange-700 transition text-sm">Upload Foto's</button>`;
                }
                if(item.action === 'renew' && item.status === 'Actie Vereist'){
                    actionButton = `<button onclick="showMarketplace()" class="mt-4 bg-gray-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-900 transition text-sm">Selecteer een nieuwe campagne</button>`;
                }


                const itemHtml = `
                    <div class="timeline-item relative pl-12 pb-10">
                        <div class="absolute left-0 flex items-center justify-center w-10 h-10 rounded-full ${isPast ? 'bg-orange-500' : 'bg-white border-2 border-gray-300'}">
                           ${isPast ? '<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>' : ''}
                        </div>
                        <div class="ml-4">
                            <div class="flex items-center gap-3">
                                <h4 class="font-bold">${item.title}</h4>
                                <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${statusColors[item.status]}">${item.status}</span>
                            </div>
                            <p class="text-sm text-gray-500">${item.date.toLocaleDateString('nl-BE', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                            <p class="mt-2 text-sm text-gray-600">${item.desc}</p>
                            ${actionButton}
                        </div>
                    </div>
                `;
                timelineContainer.innerHTML += itemHtml;
            });
        }
        
        function openQrModal(){
            qrModal.classList.add('active');
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            const typeNumber = 4;
            const errorCorrectionLevel = 'L';
            const qr = qrcode(typeNumber, errorCorrectionLevel);
            // This would be a unique URL for the upload page
            qr.addData(`https://sticki.one/upload/session-12345`);
            qr.make();
            qrContainer.innerHTML = qr.createImgTag(6, 8); // (cellSize, margin)
        }

        function showMarketplace() {
            activeCampaign = null;
            progressView.classList.add('hidden');
            marketplaceView.classList.remove('hidden');
            renderMarketplace();
        }

        // --- EVENT LISTENERS ---
        confirmCheckbox.addEventListener('change', () => {
            if (confirmCheckbox.checked) {
                confirmBtn.disabled = false;
                confirmBtn.classList.remove('bg-gray-500', 'cursor-not-allowed');
                confirmBtn.classList.add('bg-gray-800', 'hover:bg-gray-900');
            } else {
                confirmBtn.disabled = true;
                confirmBtn.classList.add('bg-gray-500', 'cursor-not-allowed');
                confirmBtn.classList.remove('bg-gray-800', 'hover:bg-gray-900');
            }
        });
        
        document.getElementById('confirm-address-btn').addEventListener('click', () => {
            document.getElementById('modal-step-1').classList.remove('active');
            document.getElementById('modal-step-2').classList.add('active');
        });

        document.getElementById('cancel-btn').addEventListener('click', () => {
             confirmModal.classList.remove('active');
        });

        confirmBtn.addEventListener('click', () => {
            const campaignId = parseInt(confirmModal.dataset.campaignId);
            confirmModal.classList.remove('active');
            confirmCheckbox.checked = false;
            confirmBtn.disabled = true;
            confirmBtn.classList.add('bg-gray-500', 'cursor-not-allowed');
            confirmBtn.classList.remove('bg-gray-800', 'hover:bg-gray-900');
            startCampaign(campaignId);
        });

        confirmModal.querySelector('.close-button').addEventListener('click', () => confirmModal.classList.remove('active'));
        qrModal.querySelector('.close-button').addEventListener('click', () => qrModal.classList.remove('active'));


        // --- INITIAL RENDER ---
        renderMarketplace();

    </script>

</body>
</html>

